<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Implementation details of NetCoupler • NetCoupler</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Implementation details of NetCoupler">
<meta property="og:description" content="NetCoupler">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NetCoupler</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/NetCoupler.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/description.html">Implementation details of NetCoupler</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/NetCoupler/NetCoupler/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="description_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Implementation details of NetCoupler</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NetCoupler/NetCoupler/blob/master/vignettes/description.Rmd" class="external-link"><code>vignettes/description.Rmd</code></a></small>
      <div class="hidden name"><code>description.Rmd</code></div>

    </div>

    
    
<p><img src="https://img.shields.io/badge/document%20status-rough%20draft-red?style=flat-square"></p>
<div id="explanation-of-netcoupler" class="section level2">
<h2 class="hasAnchor">
<a href="#explanation-of-netcoupler" class="anchor" aria-hidden="true"></a>Explanation of NetCoupler</h2>
<p>The <em>NetCoupler</em>-algorithm operates by taking the following steps:</p>
<ol style="list-style-type: decimal">
<li>The implementation of the PC-algorithm [1] in the pcalg package <span class="citation">[@Kalisch2012]</span> is applied to estimate the skeleton of the underlying directed acyclic graph (DAG) that generated the complex exposure data (e.g., metabolomics data).</li>
<li>For each network variable (e.g., metabolite), the adjacency set (all direct neighbors) is extracted from this undirected network. Assuming complete coverage of the measurements, the Markov parents of the network variable are necessarily a subset of its direct network neighbors. Adjustment for the Markov parents is sufficient to block all confounding influences by other network-variables (d-separation). Adjusting for descendants should be avoided because it can potentially introduce collider bias.</li>
<li>A multi-model procedure is applied. The relation of each network variable with time-to-the event of interest is adjusted for every possible subset of direct neighbors. Thereby, a confidence set of estimates is generated, which necessarily contains the valid direct effect estimate.</li>
<li>Network variables are classified based on the bounds of this confidence set of possible direct effects. As default, network variables are classified as directly affecting the outcome only if the confidence set of possible direct effects contains exclusively significant and consistent effect estimates.</li>
<li>The multi-model procedure is looped with adjusting all models for the previously identified direct effects (because these are potential confounders but cannot be colliders) until no further direct effects are identified.</li>
</ol>
<p>A similar procedure is provided to identify direct influences of external factors on network variables.</p>
<p>Given that 1) an exposure can potentially affect metabolite concentrations (<code>exposure -&gt; metabolic network</code>) and that 2) metabolites can potentially affect the development of a disease (<code>metabolic network -&gt; outcome</code>), two algorithms are needed, one for the exposure side and one for the disease/outcome side. The explanation and description of NetCoupler are taken heavily from Clemens Wittenbecher’s PhD thesis <span class="citation">[@Wittenbecher2017]</span>.</p>
<div id="metabolic-network-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#metabolic-network-estimation" class="anchor" aria-hidden="true"></a>Metabolic network estimation</h3>
<p>TODO: Explain PC algorithm..?</p>
<div id="directed-acyclic-graph-skeleton-estimation" class="section level4">
<h4 class="hasAnchor">
<a href="#directed-acyclic-graph-skeleton-estimation" class="anchor" aria-hidden="true"></a>Directed acyclic graph skeleton estimation</h4>
<p>The estimate the underlying directed acyclic graph (DAG) skeleton of the metabolite network, NetCoupler uses an implementation of the PC-algorithm <span class="citation">[@Kalisch2012;@Maathuis2010;@Spirtes2001;@Colombo2014]</span>. Because of this, the assumptions from the PC-algorithm apply to NetCoupler. The output of this algorithm is a graphical model (<code>G</code>) of the underlying network that is used by NetCoupler.</p>
</div>
</div>
<div id="exposure-side-network-effect-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#exposure-side-network-effect-estimation" class="anchor" aria-hidden="true"></a>Exposure-side network effect estimation</h3>
<p>The exposure-side network retrieves a range of potential direct effects of exogenous {{word?}} factors on the metabolite network. The algorithmic pseudocode from functional programming perspective for the exposure-side estimation is:</p>
<pre><code>input DAG skeleton
input data with network variables (M), exposure (X), 
    and confounder (C) variables

set index nodes as list of all M
set neighbour nodes as list of M with an edge to the index node
    extract from DAG skeleton

set direct effect as empty
for each index node in all index nodes
    assign new direct effects from previous loop
    skip if index node is already set as direct effects
    extract all possible combinations of neighbour nodes from index node
        set as node combinations
    map model onto node combinations
        model formulas as index node on X conditioned on:
            node combinations, confounders, and direct effects
        set as model list with estimate and p-value
    set base model as model without neighbour nodes
    classify as direct effect if:
        (minimum estimate is &gt; 0 or
            maximum estimate is &lt; 0) and
        sign of p-value = sign of base model p-value
    classify as ambigious if:
        (minimum estimate is &gt; 0 or
            maximum estimate is &lt; 0) and
        (any estimate = 0 and
            sign of p-value is not = sign of base model p-value)
    classify as no effect otherwise

output confidence set of effects of X on M, based on DAG skeleton
    where each index node has a classification</code></pre>
<p>This assumes full source population information. For applications to a sample of the population, the following decision rules were applied:</p>
<ol style="list-style-type: decimal">
<li>Consider the exposure-metabolite pair only if associated at a false discovery rate (FDR) controlled p-value &lt;0.01 based on a model <em>not adjusted</em> for the adjacent metabolites (<code>S</code> is empty {{correct?}}, the marginal model).</li>
<li>Consider the effect estimates as zero (0) if the p-value is &gt;0.05.</li>
</ol>
<p>For a given exposure, a metabolite would be classified as non-affected if the FDR-adjusted p-value was non-significant in the marginal model. If there was a significant FDR-controlled p-value in the marginal model and all estimates in the confidence set (<code>CS</code> {{? correct?}}) were significant and consistent, then the metabolite would be classified as affected by the exposure. Other metabolites would be classified as ambiguous with respect to the exposure.</p>
<p>{{TODO: reduce reliance on p-values or use another metric? Or do some bootstrapping/CV?}}</p>
<p>The outer loop includes identifying directly affected metabolites into the fixed model part. Then the procedure was repeated on the still ambiguous metabolites to check whether further unambiguous classification was possible based on the additional information. In the applied version of NetCoupler, this was limited to metabolites in the same connected components, which are defined as a group of two or more directly linked metabolites that were all associated with the exposure in the marginal model.</p>
<p>The rationale was that indirect effects could only be mediated by metabolites that were themselves (directly or indirectly) affected by the exposure. These metabolites were expected to be marginally associated with the exposure. In theory, there could be possible scenarios where the incidental cancellation of several direct and indirect effects concealed exposure-dependency in the marginal model <span class="citation">[@Pearl2009]</span></p>
<p>Still, high abundance of incidental cancellations are considered unlikely based on observed correlation structures and the chance to unambiguously resolve such complicated scenarios in the applied modelling approach is low {{proof of claim?}}. Therefore, the pragmatic decision was taken to adjust remaining ambiguous metabolites only for directly affected metabolites identified within the same connected component.</p>
<p>{{TODO: rearrange this}}</p>
<p>Network adjustments were used to resolve indirect effects mediated by another network variable (e.g. <code>exposure -&gt; mediating metabolite -&gt; metabolite</code>).</p>
</div>
<div id="outcome-side-network-effect-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#outcome-side-network-effect-estimation" class="anchor" aria-hidden="true"></a>Outcome-side network effect estimation</h3>
<p>The outcome-side network retrieves direct effects of network variables on later occurring events.</p>
<p>There are similarities to the exposure-side algorithm for the outcome-side algorithm, except that the directionality is reversed (<code>metabolite -&gt; outcome</code>). This change in directionality also has implications on the decision rules. There may also be potential network-variable confounders and introduction of spurious associations (<code>metabolite &lt;- confounding metabolite -&gt; outcome</code>). The general algorithm for the outcome-side estimation is:</p>
<pre><code>Aim: To estimate independentdirect effects between a network
INPUT graphical DAG skeleton model (G) 
INPUT data with network variables (M), outcome (O), and confounders (C)

observations on: network variables (M), outcome (O), confounders (C)

begin with empty direct effect (DE)
repeat until no further ith M (Mi) is classified as DE
    add new DE to DE
    begin where AMB = M
    repeat until all Mi have been selected
        select a variable Mi from M {{not AMB?}}
        select all nodes adjacent to Mi in G, adj(G, Mi)
        repeat until no further non-redundant subset (S) can be selected from adj(G, Mi)
            select a S from adj(G, Mi)
            estimate outcome as a function of Mi conditional on S, C
            add effect estimate PE for Mi on O to confidence set (CSi)
        end
        if the lower bound of CSi &gt; 0 or upper bound of CSi &lt; 0 and
                sign(pe1) = sign(pe2) for every pair of estimates in CSi
            classify Mi as affecting risk of O
        else if lower bound of CSi &gt; 0 or upper bound of CSi &lt; 0 and
                0 is in CSi or 
                sign(pe1) = sign(pe2) for any pair of estimates in CSi
            classify Mi as ambiguous with respect to risk of O
        else
            classify Mi as non-affecting risk to O
    end
end

output: CS for effects of M on O based on G

classification of every Mi from M as 
    effector on O (Mi -&gt; O)
    non-effector on O (Mi  O)
    ambiguous (Mi -- O)</code></pre>
<p>Where <code>AMB</code> is {{meaning?}}, <code>PE</code> is {{meaning?}}, <code>adj(G, Mi)</code> is the set of nodes adjust to <code>Mi</code> in <code>G</code> that are congruent (<span class="math inline">\(\equiv\)</span>) to direct neighbors of <code>Mi</code> in <code>G</code>.</p>
<p>An indirect effect, unlike confounding, is not biased. Decision rules were adjusted to avoid bias:</p>
<ol style="list-style-type: decimal">
<li>Consider a metabolite-outcome pair only if significantly associated at a FDR-adjusted p-value &lt;0.1 based on a model adjusted for all adjacent metabolites (<code>S = adj(Mi)</code>)</li>
<li>Consider effect estimates as 0 if p-value is &gt;0.05</li>
</ol>
<p>Metabolites are classified as affecting the outcome if the FDR-adjusted p-value was significant in the model adjusted for the full adjacency set and all estimates in the confidence set are significant and consistent. Metabolites are considered not directly affecting the outcome if they were not significantly associated in the model adjusted for the full adjacency set. All others were considered ambiguous.</p>
</div>
<div id="step-wise-iteration-for-full-network-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#step-wise-iteration-for-full-network-estimation" class="anchor" aria-hidden="true"></a>Step-wise iteration for full network estimation</h3>
<ol style="list-style-type: decimal">
<li>The DAG skeleton of the metabolite network is estimated</li>
<li>Initial, tentative links are formed with the exposure-side of the network.</li>
<li>Direct effects are estimated between exposure and network.</li>
<li>Repeat identification of links, classifying as unaffected or ambiguous and deleting indirect links.</li>
<li>Initial, tentative links are formed with the outcome-side of the network.</li>
<li>Direct effects are estimated between the network and the outcome.</li>
<li>Repeat link identification, deleting indirect links and classifying others as unaffected or ambiguous.</li>
<li>Combine the exposure-side and outcome-side network estimates into a joint graphical model.</li>
</ol>
<!-- TODO: Put this into a bib file. --><ol style="list-style-type: decimal">
<li><em>Spirtes P, Glymour C. An Algorithm for Fast Recovery of Sparse Causal Graphs. Social Science Computer Review 1991;9:62-72.</em></li>
</ol>
<!-- thesis https://publishup.uni-potsdam.de/frontdoor/index/index/searchtype/collection/id/17105/start/1/rows/10/facetNumber_author_facet/all/doctypefq/doctoralthesis/docId/40459 --><p>2 <em>Markus Kalisch, Martin Maechler, Diego Colombo, Marloes H. Maathuis, Peter Buehlmann (2012). Causal Inference Using Graphical Models with the R Package pcalg. Journal of Statistical Software, 47(11), 1-26. URL <a href="http://www.jstatsoft.org/v47/i11/" class="external-link uri">http://www.jstatsoft.org/v47/i11/</a>.</em></p>
</div>
</div>
<div id="confidence-ranges-based-on-multi-model-procedures" class="section level2">
<h2 class="hasAnchor">
<a href="#confidence-ranges-based-on-multi-model-procedures" class="anchor" aria-hidden="true"></a>Confidence ranges based on multi-model procedures</h2>
<p>The estimated DAG skeleton … {{complete later. Not clear about this right now. (page 43 of thesis)}}</p>
</div>
<div id="data-pre-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#data-pre-processing" class="anchor" aria-hidden="true"></a>Data pre-processing</h2>
<p>Metabolic variables should be log-transformed and standardized on potential confounders {{this the best way?}} by regressing on age, sex, BMI, and prevalence of hypertension and using the residual variance in further models. Metabolites were then scaled (mean of zero and standard deviation of one). {{both regressed and scaled?}}</p>
<p>Apply transformations (log-transformation, standardization, regressing on) to the high dimensional metabolic data.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Luke Johnston, Clemens Wittenbecher.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
